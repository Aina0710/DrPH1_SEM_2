---
title: "Correlated numerical"
format:
  html:
    theme: sketchy
    fontsize: 1.1em
    linestretch: 1.5
    toc: true
    toc-location: left-body
    toc-depth: 2
    number-sections: true
    number-depth: 3
---

Report prepared by: 
1. Dr Aina Syazwani bt Aziz 
2. Dr Nur Shuhaiza bt Supian
3. Dr Muhammad Aminnudin

# Introduction

In healthcare settings, particularly in hospital environments, nurses' well-being and performance are closely linked to their sleep quality. Sleep disturbances among nurses have been associated with reduced job performance, increased risk of errors, and compromised patient safety. To better understand the factors influencing sleep quality, it is important to consider the organizational structure within which nurses operate. Specifically, nurses are nested within clinical departments, which are themselves nested within larger institutional frameworks such as hospitals. This hierarchical structure creates dependencies among observations that violate the assumptions of traditional single-level regression models.

In this study, multilevel modeling is employed to analyze sleep scores among nurses working in two tertiary hospitals: Hospital Universiti Sains Malaysia (HUSM) and Hospital Raja Perempuan Zainab II (HRPZ II). The data exhibit a three-level structure: individual nurses (Level 1) are nested within departments (Level 2), which are in turn nested within hospitals (Level 3). A multilevel modeling approach allows for the partitioning of variance in sleep scores across these levels, enabling a more accurate understanding of both individual and contextual factors that may influence sleep quality.

The primary outcome variable, sleep score, is continuous and reflects the overall sleep quality of each nurse. By incorporating random intercepts at both the department and hospital levels, the model accounts for unobserved heterogeneity that may arise from departmental culture, workload, shift patterns, and institutional policies. Fixed effects can be included to assess how individual characteristics (e.g., age, shift type, workload) and group-level factors (e.g., department type or hospital) impact sleep quality.

Multilevel analysis not only improves the precision of estimates by accounting for clustering but also offers insights into how much of the variability in sleep outcomes is attributable to departments or hospitals. This approach supports more targeted and level-specific interventions to enhance nurse well-being and, by extension, healthcare quality.

# Methodologies
## About the Data
The data comprises 470 participants distributed across two tertiary hospitals in Kelantan. This data structure is nested because multiple nurses were sampled from each tertiary hospitals. And from each hospital, the nurses were sampled form four different departments. Therefore, the data has three levels of sampling: Level 1 includes staff (each row in the dataset), Level 2 includes departments (Emergency, Pediatrics, Surgical, Medical) and Level 3 includes tertiary hospitals (HUSM, HRPZ II).


Given this nested structure, the dataset is suitable for hierarchical data analysis. In our linear mixed model, the dependent or outcome variable, Sleep Quality Score, is predicted by the fixed factors of: 
i-	Working hours (continuous)
ii-	Working Schedules (shift/non-shift)
iii-	Comorbidity (yes/no)

# Load packages

### General packages
```{r}
library(tidyverse)
library(gtsummary)
library(kableExtra)
library(plotly)
library(haven)
library(broom.mixed)
library(DT)
library(readxl)
```

### Packages for multilevel
```{r}
library(lme4)
library(lmerTest)
```

# Read data
```{r}
sleep <- read_excel("sleep2.xlsx")
glimpse(sleep)
```

# Data wrangling
```{r}
sleep<-sleep %>% mutate_if(is.character,~ as_factor(.))
glimpse(sleep)
```
# Exploratory Data Analysis
```{r}
summary(sleep)
sleep %>% select(-id) %>% 
  tbl_summary(
    statistic = list(all_continuous() ~
                                 "{mean} ({sd})")) %>% 
  bold_labels()

```

```{r}
sleep<- sleep %>% 
```


# Single level analysis

# Multilevel analysis

# Random intercept model

## Explanatory variable

## Prediction

## Plot

## Variance

### Between hospital

### Within hospital

# Random slope model

## Model

## Fitted value

# Comparing model (RI vs RS)

# Interpretation
